@model ContentManager.ViewModels.TourWpfViewModel
@using System.Collections.ObjectModel
@using HoloTour.ViewModels
@{
    @*<div class="col-sm-4">*@
    @Html.AntiForgeryToken()

    <div class="form-horizontal">
        <h4>TourModel</h4>
        <hr />
        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
        <div class="form-group">

            <div class="container">
                <div id="rowImage" class="row">
                    <div class="col-md-12">
                        <img src="data:image/png;base64,@(Html.Raw(Convert.ToBase64String(Model.ImageBytes)))" alt="@Model.Name" />

                    </div>
                </div>
                <div id="rowName" class="row">
                    <div class="col-md-2">
                        <label> Tour Name:</label>
                    </div>
                    <div class="col-md-10">
                        @Html.EditorFor(tourVm => tourVm.Name) <br />
                    </div>
                </div>
                <div id="rowCaption" class="row">
                    <div class="col-md-2">
                        <label> Caption:</label>
                    </div>

                    <div class="col-md-10">
                        @Html.EditorFor(tourVm => tourVm.Caption)<br />
                    </div>
                </div>
                <div id="rowPoiheader" class="row">

                    <div class="col-md-12">
                        <label> Points of Interest:</label>
                    </div>
                </div>
                <div id="rowPoi" class="row">
                    <div class="col-md-12">
                        <div id="poisAccordion">

    @*@Html.EditorFor(model => model.PointsOfInterest)*@

                            @for (int i = 0; i < Model.PointsOfInterest.Count; i++)
                            {

                                PointOfInterestViewModel poi = Model.PointsOfInterest[i];
                                <div>
                                    <h3>@poi.Title</h3>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <img  style="max-width:100%;max-height:100%;" 
                                                  src="data:image/png;base64,@(Html.Raw(Convert.ToBase64String(poi.ImageBytes)))" 
                                                  alt="@poi.Title" />
                                            </div>
                                            <div class="col-md-8">
                                                <p>
                                                    @poi.Guide.Text
                                                </p>
                                            </div>
                                        </div>
                                </div>
                                @*<li class="ui-state-default">@poi.Title</li>*@
                            }

                        </div>
                    </div>
                  


                </div>


            </div>
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Save" class="btn btn-default" />
            </div>
        </div>
    </div>

    @Html.Script(
        @<script type="text/javascript"> 
          
            $(document).ready(function () {         
                var icons = {
                    header: "ui-icon-circle-arrow-e",
                    activeHeader: "ui-icon-circle-arrow-s"
                };
                var accordion = $('#poisAccordion');
                accordion.accordion({
                    collapsible: true,
                    active: false, //collapse all
                    icons: icons,
                    heightStyle: "content",
                     header: '> div > h3',
                    autoHeight: false
                })
               .sortable({
                    axis: "y",
                    handle: "h3",
                    stop: function (event, ui) {
                        // IE doesn't register the blur when sorting
                        // so trigger focusout handlers to remove .ui-state-focus
                        ui.item.children("h3").triggerHandler("focusout");

                        // Refresh accordion to handle new order
                        $(this).accordion("refresh");
                    }
                });

                $("#toggle").button().on("click", function () {
                    if ($("#accordion").accordion("option", "icons")) {
                        $("#accordion").accordion("option", "icons", null);
                    } else {
                        $("#accordion").accordion("option", "icons", icons);
                    }
                });

                accordion.collapse();
        
        });


        </script>
   
    )
}
